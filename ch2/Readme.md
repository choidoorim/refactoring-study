# Ch2 - 리팩터링 원칙
## 2.1 리팩터링 정의
- 리팩터링은 기능에는 영향을 미치지 않고 코드의 질을 높이는 것이다. 즉, 리팩터링 전과 후의 코드가 똑같이 동작 해야한다.


- 명사로는 **"코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법"** 이며, 동사로는 **"여러 가지 리팩터링 기법을 적용해서 소프트웨어를 재구성하다"** 이다.
  - 명사: 함수 추출하기, 조건부 로직을 다형성으로 바꾸기 등
  

- 한 번에 바꿀 수 있는 작업을 수많은 단계로 잘게 나눠서 작업한다. 이를 통해 단계들이 체계적으로 구성되어 있기도 하고, 무엇보다 디버깅하는 데 많은 시간을 소요하지 않아도 된다.

## 2.2 두 개의 모자
- 기능 추가라는 모자와 리팩터링이라는 모자 2개를 바꿔쓰면서 개발을 해야 한다.


- 기능 추가는 기존 코드는 절대 건드리지 않고 새 기능을 추가하기만 한다.


- 리팩터링은 기능 추가는 절대 하지 않기로 다짐한 뒤 오로지 코드 재구성에만 전념한다.


## 2.3 리팩터링 하는 이유
- 중복 코드 제거는 설계 개선 작업의 중요한 요소이다. 시스템이 빨라지거나 용량이나 속도에 영향을 주는 경우는 별로 없다. 하지만 수정하는 데 드는 노력은 크게 달라지게 된다.
즉, 사람이 **소프트웨어를 이햐하는데 소요하는 시간을 줄일 수 있기에** 생산성을 높일 수 있다.


- 프로그램의 구조를 명확하게 다듬으면 그냥 '이럴 것이다' 라고 가정하던 점들이 분명히 드러나고, **버그를 지나칠 수 없을 정도까지 명확**해지게 된다.


- 리팩터링을 하면 프로그래밍 속도를 높일 수 있다. 리팩터링에 시간이 드니 전체 개발 속도는 떨어질까봐 걱정할 수도 있다.
하지만 리팩터링 되지 않은 시스템일 경우 커질 수록 기능을 추가하는 데 오래 걸린다. 즉, 기존 코드베이스에 잘 녹여낼 방법을 찾는 데 드는 시간이 늘어난다.

## 2.4 언제 리팩터링해야 할까?
### 3 의 법칙
1. 처음에는 그냥 한다.
2. 비슷한 일을 두 번째로 하게 되면(중복이 생긴다면), 일단 계속 진행한다.
3. 비슷한 일을 세 번째 하게 되면 리팩터링한다.

즉, 스트라이크 3 번이면 리팩터링해야 한다.

### 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기
복사 붙여넣는 방식으로 계속 처리하게 된다면 기능을 약간 변형한 버전을 만들어야 할 때 번거로울 수 있다.
이럴 때 **"함수 매개변수화"** 를 한다.

우선 한 곳으로 합치면 버그를 잡기도 훨씬 편하고, 오류를 크게 줄일 수 있다.

### 이해를 위한 리팩터링: 코드를 이해하기 쉽게 만들기
조건부 로직의 구조가 이상하지 않은지, 함수 이름이 이상해서 하는 일을 파악하는 데 시간이 오래걸리지는 않은지 살펴봐야 한다.
어떤 역할은 하는지 이해되게 변수를 만들고, 긴 함수는 잘게 나눠야 한다.

### 쓰레기 줍기 리팩터링
간단히 수정할 수 있는 것은 즉시 수정하고, 시간이 조금 걸리는 일은 짧은 메모만 남긴 다음, 하던 일을 마무리 한 뒤 처리한다.
이것이 **쓰레기 줍기 리팩터링** 이다.

### 계획된 리팩터링과 수시로 하는 리팩터링
- 리팩터링 시간을 일정에 따로 잡아두지 않고, 대부분의 리팩터링을 다른 일을 하는 중에 처리한다.

- 새 기능을 추가하기 쉽도록 코드를 수정하는 것이 기능을 가장 빠르게 추가하는 방법이다.

- 계획된 리팩터링은 팀 전체의 효율을 떨어트릴수도 있기 때문에, 리팩터링은 드러나지 않게 기회가 될 때마다 해야 한다.

### 오래 걸리는 리팩터링
- 오래 걸리는 리팩터링이라면 몇 주에 걸쳐 조금식 해결해가는 편이 효과적일 때가 많다.

### 코드 리뷰에 리팩터링 활용하기
- 코드 리뷰는 개발팀 전체에 지식을 전파하는 데 좋다. 경험이 더 많은 개발자의 노하우를 더 적은 개발자에게 전수할 수 있다.

- 내 눈에는 명확한 코드가 다른 팀원에게는 그렇지 않을 수 있다. 코드리뷰를 하면서 다른 사람의 아이디어를 얻을 수 있다는 장점도 있다.

- 글쓴이의 가장 좋은 방법은 작성자와 나란히 앉아서 코드를 훑어가면서 리팩터링 하는 것이라고 한다. 이렇게 하는 것이 짝 프로그래밍이다.

### 리팩터링을 하지 말아야 할 때
- 리팩터링보다 처음부터 새로 작성하는 게 쉬울 때도 리팩터링하지 않는다.

## 2.5 리팩터링 시 고려할 문제